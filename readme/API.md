# API 接口说明

## API授权配置

第三方访问API接口数据需要先在Cat2Bug-Platform系统配置授权API_KEY(注意:每个项目需要单独配置API_KEY，API_KEY和项目是一对一的关系)。

1. 点击项目中的【项目设置】->【API KEY】选项，进入API授权页面；

![选择Api Key](./images/api/api_key_link.png)

2. 点击右侧【新建Key】按钮打开【添加项目API】对话框创建新的授权信息；

![创建Api Key](./images/api/api_key_add.png)

3. 创建保存后，可以在【API KEY】列表中查看授权码；

![查看Api Key](./images/api/api_key_list.png)

## 接口调用

第三方系统调用Cat2Bug-Platform接口时，需要在接口请求头部添加之前创建的【API KEY】，变量名为CAT2BUG-API-KEY，如下示例：

````shell
curl --location -X POST 'http://localhost:2020/api/defect' \
-H 'Content-Type: application/json' \
-H 'CAT2BUG-API-KEY: 202411011547433W484U00XIEXL3U6' \
-d '{"defectType": 1, "defectName":"defectName", "defectDescribe":"defectDescribe", "defectLevel":2 }'
````

## 业务接口说明

### 查看交付物树形列表

方法：GET

路径：/api/deliverable

Request请求参数：

| 参数名                | 类型  | 是否必填 | 说明                     |
|--------------------|:---:|:----:|:-----------------------|
| deliverablePid     | 长整形 |  否   | 交付物父ID,如不填,查询根节点的交付物列表 |

Response返回值：

* 返回主体说明

| 参数名   | 类型  | 是否必返 | 说明          |
|-------|:---:|:----:|:------------|
| data  | 数组  |  是   | 交付物树形数组     |
| code  | 字符型 |  是   | 返回码，正常返回200 |
| msg   | 字符型 |  是   | 接口返回消息      |

* data数组中交付物对象的格式说明

| 参数名               | 类型  | 是否必返 | 说明                |
|-------------------|:---:|:----:|:------------------|
| deliverableId     | 长整型 |  是   | 交付物ID             |
| deliverableName   | 字符型 |  是   | 交付物名称             |
| projectName       | 字符型 |  是   | 所属项目名称            |
| deliverablePid    | 长整型 |  否   | 交付物的父ID           |
| children          | 数组  |  否   | 交付物子对象数组          |
| remark            | 字符型 |  否   | 备注                |

### 查看测试用例列表

方法：GET

路径：/api/case

Request请求参数：

| 参数名                | 类型  | 是否必填 | 说明                                         |
|--------------------|:---:|:----:|:-------------------------------------------|
| pageNum            | 整数  |  否   | 默认1,页码                                     |
| pageSize           | 整数  |  否   | 默认10,页尺寸                                   |
| caseName           | 字符型 |  否   | 测试用例名称                                     |
| deliverableName         | 字符型 |  否   | 交付物名称,多个层级用/分隔                             |

Response返回值：

* 返回主体说明

| 参数名             | 类型  | 是否必返 | 说明          |
|-----------------|:---:|:----:|:------------|
| total           | 长整型 |  是   | 缺陷总数        |
| rows            | 数组  |  是   | 测试用例对象数组    |
| code            | 字符型 |  是   | 返回码，正常返回200 |
| msg             | 字符型 |  是   | 接口返回消息      |

* rows数组中缺陷对象的格式说明

| 参数名               |  类型  | 是否必返 | 说明                                 |
|-------------------|:----:|:----:|:-----------------------------------|
| caseNum           | 长整型  |  是   | 测试用例编号,每个项目中是唯一值,不同项目中的测试用例编号有可能重复 |
| caseName          | 字符型  |  是   | 测试用例名称                             |
| caseExpect        | 字符型  |  是   | 预期                                 |
| caseStep          |  数组  |  否   | 步骤数组                               |
| caseLevel         | 字符型  |  是   | 测试用例等级,范围(1-5)                     |
| deliverableName        | 字符型  |  否   | 关联的交付物名称,多个层级用/分隔                  |
| casePreconditions | 字符型  |  否   | 前置条件                               |
| createTime        |  日期  |  是   | 创建时间                               |
| updateTime        |  整数  |  是   | 更新时间                               |
| imgUrlList        |  数组  |  否   | 测试用例图片路径集合                         |
| projectName       | 字符型  |  是   | 项目名称                               |
| remark            | 字符型  |  否   | 备注                                 |

* caseStep数组中步骤对象的格式说明

| 参数名           |    类型     |  是否必返   | 说明       |
|---------------|:---------:|:-------:|:---------|
| stepDescribe  |    字符型    |    否    | 步骤描述     |
| stepExpect    |    字符型    |    否    | 步骤预期     |

### 查看项目成员列表

方法：GET

路径：/api/member

Request请求参数：无

Response返回值：

* 返回主体说明

| 参数名  | 类型  | 是否必返 | 说明          |
|------|:---:|:----:|:------------|
| rows | 数组  |  是   | 用户数组        |
| code | 字符型 |  是   | 返回码，正常返回200 |
| msg  | 字符型 |  是   | 接口返回消息      |

* data数组中交付物对象的格式说明

| 参数名          | 类型  | 是否必返 | 说明                             |
|--------------|:---:|:----:|:-------------------------------|
| memberId     | 长整型 |  是   | 成员ID                           |
| memberName   | 字符型 |  是   | 成员名称                           |
| phoneNumber  | 字符型 |  是   | 手机号                            |
| email        | 字符型 |  否   | 电子邮箱                           |
| roleNameList | 数组  |  是   | 角色数组,范围(项目创建人、项目经理、开发、测试、外部人员) |

### 上传图片

方法：POST

路径：/api/image

Headers设置

{'Content-Type': 'multipart/form-data'}

Request请求参数：

| 参数名             | 类型  | 是否必填 | 说明         |
|-----------------|:---:|:----:|:-----------|
| file            | 字符型 |  是   | base64图片编码 |

Response返回值：

* 返回主体说明

| 参数名              | 类型  | 是否必返 | 说明            |
|------------------|:---:|:----:|:--------------|
| url              | 字符型 |  是   | 用户数组          |
| fileName         | 字符型 |  是   | 返回码，正常返回200   |
| fileExtension    | 字符型 |  是   | 接口返回消息        |
| originalFilename | 字符型 |  是   | 原文件名          |

### 查看缺陷列表

方法：GET

路径：/api/defect

Request请求参数：

| 参数名                | 类型  | 是否必填 | 说明                                         |
|--------------------|:---:|:----:|:-------------------------------------------|
| pageNum            | 整数  |  否   | 默认1,页码                                     |
| pageSize           | 整数  |  否   | 默认10,页尺寸                                   |
| defectName         | 字符型 |  否   | 项目名称,范围:1-1024个字符                          |
| defectType         | 字符型 |  否   | 缺陷类型,范围(BUG=错误缺陷,TASK=任务,DEMAND=需求)        |
| version            | 字符型 |  否   | 版本                                         |
| params.defectState | 数组  |  否   | 缺陷状态,字符型数组,可多选,范围(0=处理中,1=待验证,3=已驳回,4=已关闭) |
| defectLevel        | 整数  |  否   | 缺陷等级,范围:1-5                                |
| handleBy           | 数组  |  否   | 处理人ID,长整型数组,可多选                            |

Response返回值：

* 返回主体说明

| 参数名             | 类型  | 是否必返 | 说明          |
|-----------------|:---:|:----:|:------------|
| total           | 长整型 |  是   | 缺陷总数        |
| rows            | 数组  |  是   | 缺陷对象数组      |
| code            | 字符型 |  是   | 返回码，正常返回200 |
| msg             | 字符型 |  是   | 接口返回消息      |

* rows数组中缺陷对象的格式说明

| 参数名            |  类型  | 是否必返 | 说明                                         |
|----------------|:----:|:----:|:-------------------------------------------|
| defectNum     | 长整型  |  是   | 缺陷编号,每个项目中是唯一值,不同项目中的缺陷编号有可能重复             |
| defectName     | 字符型  |  是   | 项目名称                                       |
| defectType     | 字符型  |  是   | 缺陷类型,范围(BUG=错误缺陷,TASK=任务,DEMAND=需求)        |
| defectState    | 字符型  |  是   | 缺陷状态,范围(0=处理中,1=待验证,3=已驳回,4=已关闭            |
| defectLevel    | 字符型  |  是   | 缺陷等级,范围(urgent=紧急,height=高,middle=中,low=低) |
| deliverableName     | 字符型  |  否   | 交付物名称,多个层级用/分隔                             |
| moduleVersion  | 字符型  |  否   | 版本                                         |
| createTime     |  日期  |  是   | 创建时间                                       |
| updateTime     |  整数  |  是   | 更新时间                                       |
| handleByList   | 用户对象 |  否   | 处理人对象集合                                    |
| imgUrlList     |  数组  |  否   | 缺陷图片路径集合                                   |
| annexUrlList   |  数组  |  否   | 缺陷附件路径集合                                   |
| projectName    | 字符型  |  是   | 项目名称                                       |
| defectGroupKey | 字符型  |  是   | 缺陷组标识                                      |
| defectKey      | 字符型  |  是   | 缺陷唯一标识                                     |
| defectDescribe | 字符型  |  否   | 缺陷描述                                       |
| currentLog     | 日志对象 |  是   | 当前最新的缺陷日志                                  |

### 创建缺陷

方法：POST

路径：/api/defect

Request请求参数：

| 参数名            | 类型  | 是否必返 | 说明                                                 |
|----------------|:---:|:----:|:---------------------------------------------------|
| defectName     | 字符型 |  是   | 项目名称,范围:1-1024个字符                                  |
| defectType     | 字符型 |  是   | 缺陷类型,范围(BUG=错误缺陷,TASK=任务,DEMAND=需求)                |
| defectLevel    | 字符型 |  否   | 缺陷等级,范围(urgent=紧急,height=高,middle=中,low=低)         |
| deliverableName     | 长整型 |  否   | 交付物名称,多个层级用/分隔                                     |
| moduleVersion  | 字符型 |  否   | 版本                                                 |
| handleBy       | 长整型 |  否   | 处理人ID集合                                            |
| imgUrlList     | 数组  |  否   | 缺陷图片路径集合                                           |
| annexUrlList   | 数组  |  否   | 缺陷附件路径集合                                           |
| defectGroupKey | 字符型 |  否   | 缺陷组标识,范围:1-512个字符,重复提交时请求变为更新缺陷数据                  |
| defectKey      | 字符型 |  否   | 缺陷唯一标识,范围:1-1024个字符,重复提交时请求变为更新缺陷数据                |
| defectDescribe | 字符型 |  否   | 缺陷描述,范围:0-1024                                     |

Response返回值：

* 返回主体说明

| 参数名  | 类型  | 是否必返 | 说明          |
|------|:---:|:----:|:------------|
| data | 对象  |  是   | 创建的缺陷对象     |
| code | 字符型 |  是   | 返回码，正常返回200 |
| msg  | 字符型 |  是   | 接口返回消息      |


* data中缺陷对象的格式说明

| 参数名            |  类型  | 是否必返 | 说明                                         |
|----------------|:----:|:----:|:-------------------------------------------|
| defectNum     | 长整型  |  是   | 缺陷编号,每个项目中是唯一值,不同项目中的缺陷编号有可能重复             |
| defectName     | 字符型  |  是   | 项目名称                                       |
| defectType     | 字符型  |  是   | 缺陷类型(BUG=错误缺陷,TASK=任务,DEMAND=需求)           |
| defectState    | 字符型  |  是   | 缺陷状态,范围(0=处理中,1=待验证,3=已驳回,4=已关闭            |
| defectLevel    | 字符型  |  是   | 缺陷等级,范围(urgent=紧急,height=高,middle=中,low=低) |
| deliverableName     | 字符型  |  否   | 交付物名称,多个层级用/分隔                             |
| moduleVersion  | 字符型  |  否   | 版本                                         |
| createTime     | 日期型  |  是   | 创建时间                                       |
| updateTime     | 日期型  |  是   | 更新时间                                       |
| handleByList   |  数组  |  否   | 处理人对象集合                                    |
| imgUrlList     |  数组  |  否   | 缺陷图片路径集合                                   |
| annexUrlList   |  数组  |  否   | 缺陷附件路径集合                                   |
| projectName    | 字符型  |  是   | 项目名称                                       |
| defectGroupKey | 字符型  |  是   | 缺陷组标识                                      |
| defectKey      | 字符型  |  是   | 缺陷唯一标识                                     |
| defectDescribe | 字符型  |  否   | 缺陷描述                                       |
| currentLog     | 日志对象 |  是   | 缺陷描述                                       |

### 查看缺陷详情

方法：GET

路径：/api/defect/{缺陷编号}

Request请求参数：无

Response返回值：

* 返回主体说明

| 参数名  | 类型  | 是否必返 | 说明          |
|------|:---:|:----:|:------------|
| data | 对象  |  是   | 创建的缺陷对象     |
| code | 字符型 |  是   | 返回码，正常返回200 |
| msg  | 字符型 |  是   | 接口返回消息      |


* data中缺陷对象的格式说明

| 参数名            |  类型  | 是否必返 | 说明                                          |
|----------------|:----:|:----:|:--------------------------------------------|
| defectNum     | 长整型  |  是   | 缺陷编号,每个项目中是唯一值,不同项目中的缺陷编号有可能重复              |
| defectType     |  整数  |  是   | 缺陷类型(BUG=错误缺陷,TASK=任务,DEMAND=需求)            |
| defectName     | 字符型  |  是   | 项目名称                                        |
| defectState    | 字符型  |  是   | 缺陷状态,范围(0=处理中,1=待验证,3=已驳回,4=已关闭             |
| defectLevel    | 字符型  |  是   | 缺陷等级,范围(urgent=紧急,height=高,middle=中,low=低)  |
| deliverableName     | 字符型  |  否   | 交付物名称,多个层级用/分隔                              |
| moduleVersion  | 字符型  |  否   | 版本                                          |
| createTime     |  日期  |  是   | 创建时间                                        |
| updateTime     |  整数  |  是   | 更新时间                                        |
| handleByList   | 用户对象 |  否   | 处理人对象集合                                     |
| imgUrlList     |  数组  |  否   | 缺陷图片路径集合                                    |
| annexUrlList   |  数组  |  否   | 缺陷附件路径集合                                    |
| projectName    | 字符型  |  是   | 项目名称                                        |
| defectGroupKey | 字符型  |  是   | 缺陷组标识                                       |
| defectKey      | 字符型  |  是   | 缺陷唯一标识                                      |
| defectDescribe | 字符型  |  否   | 缺陷描述                                        |
| currentLog     | 日志对象 |  是   | 缺陷描述                                        |

### 修复缺陷

方法：POST

路径：/api/defect/{缺陷编号}/repair

Request请求参数：

| 参数名       | 类型  | 是否必返 | 说明            |
|-----------|:---:|:----:|:--------------|
| receiveBy | 数组  |  是   | 检验人ID集合,长整形集合 |
| remark    | 字符型 |  否   | 缺陷描述,范围:0-255 |

Response返回值：

| 参数名  | 类型  | 是否必返 | 说明              |
|------|:---:|:----:|:----------------|
| data | 对象  |  是   | 缺陷对象,结构同缺陷详情接口  |
| code | 字符型 |  是   | 返回码，正常返回200     |
| msg  | 字符型 |  是   | 接口返回消息          |

### 通过缺陷

方法：POST

路径：/api/defect/{缺陷编号}/pass

Request请求参数：

| 参数名       | 类型  | 是否必返 | 说明            |
|-----------|:---:|:----:|:--------------|
| remark    | 字符型 |  否   | 缺陷描述,范围:0-255 |

Response返回值：

| 参数名  | 类型  | 是否必返 | 说明              |
|------|:---:|:----:|:----------------|
| data | 对象  |  是   | 缺陷对象,结构同缺陷详情接口  |
| code | 字符型 |  是   | 返回码，正常返回200     |
| msg  | 字符型 |  是   | 接口返回消息          |

### 驳回缺陷

方法：POST

路径：/api/defect/{缺陷编号}/reject

Request请求参数：

| 参数名       | 类型  | 是否必返 | 说明            |
|-----------|:---:|:----:|:--------------|
| remark    | 字符型 |  否   | 缺陷描述,范围:0-255 |

Response返回值：

| 参数名  | 类型  | 是否必返 | 说明              |
|------|:---:|:----:|:----------------|
| data | 对象  |  是   | 缺陷对象,结构同缺陷详情接口  |
| code | 字符型 |  是   | 返回码，正常返回200     |
| msg  | 字符型 |  是   | 接口返回消息          |

### 指派缺陷

方法：POST

路径：/api/defect/{缺陷编号}/assign

Request请求参数：

| 参数名       | 类型  | 是否必返 | 说明             |
|-----------|:---:|:----:|:---------------|
| receiveBy | 数组  |  是   | 被指派人ID集合,长整形集合 |
| remark    | 字符型 |  否   | 缺陷描述,范围:0-255  |

Response返回值：

| 参数名  | 类型  | 是否必返 | 说明              |
|------|:---:|:----:|:----------------|
| data | 对象  |  是   | 缺陷对象,结构同缺陷详情接口  |
| code | 字符型 |  是   | 返回码，正常返回200     |
| msg  | 字符型 |  是   | 接口返回消息          |

### 关闭缺陷

方法：POST

路径：/api/defect/{缺陷编号}/close

Request请求参数：

| 参数名       | 类型  | 是否必返 | 说明            |
|-----------|:---:|:----:|:--------------|
| remark    | 字符型 |  是   | 缺陷描述,范围:0-255 |

Response返回值：

| 参数名  | 类型  | 是否必返 | 说明              |
|------|:---:|:----:|:----------------|
| data | 对象  |  是   | 缺陷对象,结构同缺陷详情接口  |
| code | 字符型 |  是   | 返回码，正常返回200     |
| msg  | 字符型 |  是   | 接口返回消息          |

### 开启缺陷

方法：POST

路径：/api/defect/{缺陷ID}/open

Request请求参数：

| 参数名       | 类型  | 是否必返 | 说明            |
|-----------|:---:|:----:|:--------------|
| remark    | 字符型 |  是   | 缺陷描述,范围:0-255 |

Response返回值：

| 参数名  | 类型  | 是否必返 | 说明              |
|------|:---:|:----:|:----------------|
| data | 对象  |  是   | 缺陷对象,结构同缺陷详情接口  |
| code | 字符型 |  是   | 返回码，正常返回200     |
| msg  | 字符型 |  是   | 接口返回消息          |
